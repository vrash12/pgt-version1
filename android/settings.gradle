// android/settings.gradle (Groovy DSL)

pluginManagement {
  repositories {
    gradlePluginPortal()
    google()
    mavenCentral()
  }

  // Helper to resolve a Node module path via `node --print`
  def nodeResolve = { String mod, String via ->
    def out = new ByteArrayOutputStream()
    exec {
      workingDir(rootDir)
      commandLine "node", "--print",
        "require.resolve('${mod}', { paths: [require.resolve('${via}')] })"
      standardOutput = out          // capture stdout on the Exec spec
      errorOutput = new ByteArrayOutputStream() // optional
      ignoreExitValue = false
    }
    return new File(out.toString().trim()).parentFile.absolutePath
  }

  // React Native Gradle plugin from node_modules
  def rnPluginPath = nodeResolve("@react-native/gradle-plugin/package.json",
                                 "react-native/package.json")
  includeBuild(rnPluginPath)

  // Expo Autolinking (settings) plugin from node_modules
  def expoPluginsPath = new File(
    nodeResolve("expo-modules-autolinking/package.json",
                "expo/package.json"),
    "../android/expo-gradle-plugin"
  ).absolutePath
  includeBuild(expoPluginsPath)
}

plugins {
  id("com.facebook.react.settings")
  id("expo-autolinking-settings")
}

extensions.configure(com.facebook.react.ReactSettingsExtension) { ex ->
  // Route RN autolinking via Expo's rnConfigCommand (SDK 52+)
  ex.autolinkLibrariesFromCommand(expoAutolinking.rnConfigCommand)
}

rootProject.name = "pgt"

// Expo autolinking helpers
expoAutolinking.useExpoModules()
expoAutolinking.useExpoVersionCatalog()

// ✅ Only include the app module. Do NOT manually include RN libraries.
include(":app")

// ❌ Remove any of these if you still have them (they cause "No variants exist"):
// includeBuild(expoAutolinking.reactNativeGradlePlugin)
// include(':react-native-gesture-handler', ':react-native-reanimated', ... )
